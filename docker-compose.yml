version: "3.9"
services:
  proxy:
    image: python:3.12-slim
    restart: always
    ports: ["8000:8000"]
    volumes: 
      - ./proxy:/app
      - ./vector_db:/vector_db
    working_dir: /app
    command: pip install -r requirements.txt && uvicorn main:app --host 0.0.0.0 --port 8000
    env_file: .env
    depends_on: [redis, qdrant]

  redis:
    image: redis:7-alpine
    restart: always
    volumes: [redis_data:/data]

  qdrant:
    image: qdrant/qdrant:latest
    restart: always
    ports: ["6333:6333"]
    volumes: [./vector_db:/qdrant/storage]

volumes:
  redis_data:
